<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Groot — TV Series</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #ffcc00;
      --secondary: #071022;
      --accent: #0ea5e9;
      --dark: #0f172a;
      --light: #f8fafc;
      --font-main: 'Poppins', 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
      --font-display: 'Bebas Neue', 'Poppins', sans-serif;
    }

    @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Poppins:wght@300;400;500;600;700&display=swap');

    html, body {
      height: 100%;
    }

    body {
      background-color: var(--dark);
      color: var(--light);
      font-family: var(--font-main);
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* Subtle animated gradient in background to give "DC Universe" cinematic vibe */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at 10% 20%, rgba(14,165,233,0.06), transparent 15%),
                  radial-gradient(circle at 85% 80%, rgba(255,204,0,0.05), transparent 18%),
                  linear-gradient(180deg, rgba(7,10,34,0.6), transparent 30%);
      z-index: -1;
      animation: slowShift 30s linear infinite;
      mix-blend-mode: overlay;
    }
    @keyframes slowShift {
      0% { transform: translateY(0) scale(1); }
      50% { transform: translateY(-8px) scale(1.02); }
      100% { transform: translateY(0) scale(1); }
    }

    /* General card & layout polish */
    .movie-card {
      transition: transform .45s cubic-bezier(.2,.9,.3,1), box-shadow .35s ease, opacity .3s ease;
      transform-origin: center;
      border-radius: 14px;
      overflow: hidden;
      position: relative;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.25));
      border: 1px solid rgba(255,255,255,0.03);
      will-change: transform;
    }
    .movie-card:hover {
      transform: translateY(-10px) scale(1.03);
      box-shadow: 0 30px 50px -10px rgba(0,0,0,0.6), 0 8px 20px rgba(255,204,0,0.06);
    }
    .movie-poster {
      position: relative;
      height: 18rem;
      overflow: hidden;
    }
    .movie-poster img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform .7s cubic-bezier(.2,.9,.3,1);
    }
    .movie-card:hover .movie-poster img {
      transform: scale(1.06) rotate(-0.5deg);
    }

    /* Overlay info */
    .movie-meta {
      position: absolute;
      inset: auto 0 0 0;
      padding: 14px;
      z-index: 10;
      background: linear-gradient(180deg, rgba(0,0,0,0) 20%, rgba(8,10,20,0.75));
      backdrop-filter: blur(2px);
    }
    .tag {
      font-size: 0.68rem;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(255,255,255,0.04);
      color: #e6eef8;
      margin-right: 6px;
    }

    /* Play button overlay */
    .play-overlay {
      position: absolute;
      inset: 0;
      display:flex;
      align-items:center;
      justify-content:center;
      background: linear-gradient(180deg, rgba(0,0,0,0.0), rgba(0,0,0,0.5));
      opacity: 0;
      transition: opacity .25s ease, background .25s ease;
      z-index: 12;
    }
    .movie-card:hover .play-overlay {
      opacity: 1;
    }
    .play-button {
      width: 64px;
      height: 64px;
      border-radius: 999px;
      display:flex;
      align-items:center;
      justify-content:center;
      background: radial-gradient(circle at 30% 30%, #fff, #ffefb8);
      color: #111827;
      box-shadow: 0 8px 30px rgba(255,204,0,0.14);
      transform: translateY(0);
      transition: transform .2s ease;
    }
    .play-button:hover { transform: translateY(-6px) scale(1.05); }

    /* Header / Banner */
    .series-banner {
      border-radius: 12px;
      overflow: hidden;
      display:flex;
      gap:1rem;
      align-items:center;
      background: linear-gradient(90deg, rgba(255,204,0,0.06), rgba(14,165,233,0.03));
      border: 1px solid rgba(255,255,255,0.03);
      padding: clamp(12px,2.2vw,20px);
    }
    .series-poster {
      min-width: 140px;
      width: 140px;
      height: 140px;
      border-radius: 10px;
      overflow:hidden;
      flex-shrink:0;
      border: 1px solid rgba(255,255,255,0.04);
    }
    .series-poster img { width:100%; height:100%; object-fit:cover; }

    /* Search input improvements */
    .search-input {
      padding-left: 56px;
      transition: box-shadow .25s ease, transform .2s ease;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.25));
    }
    .search-wrapper { position: relative; }
    .search-icon {
      position:absolute; left:18px; top:50%; transform:translateY(-50%);
      color: var(--primary);
      font-size: 1.05rem;
      opacity: 0.95;
    }
    .search-counter {
      position:absolute; right:18px; top:50%; transform:translateY(-50%);
      font-size:0.8rem;
      color:#111827;
      background:var(--primary);
      padding:6px 8px;
      border-radius:999px;
      display:none;
    }
    .search-input:focus { box-shadow: 0 6px 20px rgba(14,165,233,0.06), 0 0 0 4px rgba(255,204,0,0.06); }

    /* Accordion */
    .season-toggle { cursor:pointer; }
    .season-content.hidden { display:none !important; }

    /* Back to top button */
    #backToTop {
      position: fixed;
      right: 20px;
      bottom: 20px;
      width: 52px;
      height: 52px;
      border-radius: 999px;
      background: linear-gradient(180deg,#ffcc00,#ffb500);
      color:#0f172a;
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow: 0 10px 30px rgba(0,0,0,0.45);
      z-index: 70;
      border: none;
      cursor:pointer;
      transform: translateY(0);
      transition: transform .25s ease, opacity .25s ease;
      opacity: 0;
      pointer-events:none;
    }
    #backToTop.visible { opacity:1; pointer-events:auto; transform: translateY(-6px); }

    /* Responsive tweaks */
    @media (max-width: 768px) {
      .movie-poster { height: 14rem; }
      .series-poster { width: 96px; height: 96px; }
      .search-input { padding-left: 48px; }
    }

    /* Tiny fade-in animation */
    .animate-fade-in { animation: fadeIn .45s ease both; }
    @keyframes fadeIn { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:none;} }

    /* Custom scrollbar */
    ::-webkit-scrollbar { width: 8px; height:8px; }
    ::-webkit-scrollbar-track { background: rgba(255,255,255,0.02); border-radius:10px; }
    ::-webkit-scrollbar-thumb { background: linear-gradient(180deg, #ffd24d, #ffb700); border-radius:10px; }
  </style>
</head>
<body class="dark-light-transition">
  <div class="min-h-screen flex flex-col">
    <!-- Header -->
    <header class="sticky top-0 z-50 bg-gradient-to-b from-gray-900/80 to-transparent backdrop-blur-sm border-b border-black/20">
      <div class="container mx-auto px-4 py-3">
        <div class="flex justify-between items-center">
          <div class="flex items-center space-x-3">
            <div class="rounded-full p-2 bg-gradient-to-br from-yellow-400 to-yellow-300">
              <i class="fas fa-tree text-2xl text-black"></i>
            </div>
            <div>
              <h1 class="text-xl md:text-2xl font-bold gradient-text">Groot — TV Series</h1>
              <p class="text-xs text-gray-400">Short animated adventures in the Groot universe</p>
            </div>
          </div>
          <div class="flex items-center space-x-3">
            <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-700 transition" title="Toggle theme">
              <i class="fas fa-moon text-yellow-400"></i>
            </button>
            <div class="relative group">
              <button class="p-2 rounded-full hover:bg-gray-700 transition" title="Options"><i class="fas fa-sliders-h text-yellow-400"></i></button>
              <div class="absolute right-0 mt-2 w-44 bg-gray-800 rounded-md shadow-lg py-1 z-50 hidden group-hover:block">
                <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-700">Settings</a>
                <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-700">Help</a>
                <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-700">About</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Banner / Intro -->
    <div class="container mx-auto px-4 mt-6">
      <div class="series-banner p-4 md:p-5">
        <div class="series-poster shadow-lg">
          <img src="https://image.tmdb.org/t/p/w300/iecIwrRoq1uZfhJ9XRrZD29Zr4R.jpg" alt="Groot poster">
        </div>
        <div class="flex-1">
          <h2 class="text-2xl md:text-3xl font-bold mb-2">Groot — TV Series</h2>
          <p class="text-gray-300 mb-3 max-w-2xl">
            Discover the whimsical, short-form adventures of Groot across seasons — gentle humor, family moments, and tiny cosmic surprises.
          </p>
          <div class="flex gap-3">
            <a class="inline-flex items-center px-4 py-2 rounded-lg font-semibold bg-yellow-400 text-gray-900 hover:bg-yellow-300 transition" href="#">
              <i class="fas fa-play mr-2"></i> Watch Now
            </a>
            <a class="inline-flex items-center px-4 py-2 rounded-lg font-semibold bg-gray-800 text-white hover:bg-gray-700 transition" href="#">
              <i class="fas fa-info-circle mr-2"></i> More Info
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 py-6">
      <!-- Search & Filters -->
      <div class="mb-8">
        <div class="relative search-wrapper mb-4">
          <i class="fas fa-search search-icon"></i>
          <input
            id="searchBar"
            type="text"
            placeholder="Search titles, tags or episode names — try 'snow' or 'adventure'..."
            class="search-input w-full px-4 py-4 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-0"
            aria-label="Search episodes"
          />
          <div id="searchCounter" class="search-counter" role="status" aria-hidden="true">0</div>
        </div>

        <div class="flex flex-wrap gap-3 mb-4">
          <button class="filter-chip px-4 py-2 bg-gray-800 text-white rounded-full hover:bg-gray-700 active" data-filter="All Episodes">All Episodes</button>
          <button class="filter-chip px-4 py-2 bg-gray-800 text-white rounded-full hover:bg-gray-700" data-filter="Adventure">Adventure</button>
          <button class="filter-chip px-4 py-2 bg-gray-800 text-white rounded-full hover:bg-gray-700" data-filter="Comedy">Comedy</button>
          <button class="filter-chip px-4 py-2 bg-gray-800 text-white rounded-full hover:bg-gray-700" data-filter="Family">Family</button>
          <button class="filter-chip px-4 py-2 bg-gray-800 text-white rounded-full hover:bg-gray-700" data-filter="Sci-Fi">Sci-Fi</button>
        </div>

        <div class="flex justify-between items-center mb-4">
          <h3 class="text-lg font-semibold">All Episodes <span id="episode-count" class="text-yellow-400">(0)</span></h3>
          <div class="flex items-center space-x-2">
            <span class="text-gray-400">Sort by:</span>
            <select id="sortSelect" class="bg-gray-800 border border-gray-700 text-white px-3 py-1 rounded-lg focus:outline-none focus:border-yellow-400">
              <option value="release">Release Date</option>
              <option value="alpha">Alphabetical</option>
              <option value="pop">Popularity</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Seasons / Accordions -->
      <div class="space-y-8">
        <div class="season-accordion" data-season="1">
          <button class="season-toggle flex items-center justify-between w-full py-4 px-6 bg-gray-800 rounded-xl hover:bg-gray-700 transition-all">
            <h3 class="text-xl font-bold text-yellow-400">Season 1</h3>
            <i class="fas fa-chevron-down transform transition-transform duration-300"></i>
          </button>
          <div class="season-content grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6 mt-4">
            <!-- Season 1 content inserted by JS -->
          </div>
        </div>

        <div class="season-accordion" data-season="2">
          <button class="season-toggle flex items-center justify-between w-full py-4 px-6 bg-gray-800 rounded-xl hover:bg-gray-700 transition-all">
            <h3 class="text-xl font-bold text-yellow-400">Season 2</h3>
            <i class="fas fa-chevron-down transform transition-transform duration-300"></i>
          </button>
          <div class="season-content grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6 mt-4">
            <!-- Season 2 content inserted by JS -->
          </div>
        </div>
      </div>

      <!-- Loading Spinner (kept for behavior) -->
      <div id="loading-spinner" class="hidden flex justify-center items-center py-12">
        <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-yellow-400"></div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 py-6">
      <div class="container mx-auto px-4">
        <div class="flex flex-col md:flex-row justify-between items-center">
          <div class="mb-4 md:mb-0">
            <div class="flex items-center space-x-2">
              <i class="fas fa-tree text-xl text-yellow-400"></i>
              <span class="text-lg font-semibold gradient-text">Groot — TV Series</span>
            </div>
            <p class="text-gray-400 mt-2">© 2025 All Rights Reserved</p>
          </div>

          <div class="flex space-x-6">
            <a href="#" class="text-gray-400 hover:text-yellow-400 transition"><i class="fab fa-facebook-f"></i></a>
            <a href="#" class="text-gray-400 hover:text-yellow-400 transition"><i class="fab fa-twitter"></i></a>
            <a href="#" class="text-gray-400 hover:text-yellow-400 transition"><i class="fab fa-instagram"></i></a>
            <a href="#" class="text-gray-400 hover:text-yellow-400 transition"><i class="fab fa-youtube"></i></a>
          </div>
        </div>
      </div>
    </footer>
  </div>

  <!-- Back to Top Button -->
  <button id="backToTop" aria-label="Back to top">
    <i class="fas fa-arrow-up"></i>
  </button>

  <script>
    /* -------------------------
       Movie data (unchanged links)
       ------------------------- */
    const movies = [
      // Season 1
      {
        title: "Groot's First Steps",
        video: "https://skra.automatedworlds.shop:443/v4/9a/b9uzv/index-f2-v1-a1.txt",
        image: "https://image.tmdb.org/t/p/w300/iecIwrRoq1uZfhJ9XRrZD29Zr4R.jpg",
        description: "Baby Groot takes his first steps out of his pot, only to learn you have to walk before you can run.",
        duration: "6 min",
        season: 1,
        episode: 1,
        tags: ["Adventure", "Family"]
      },
      {
        title: "The Little Guy",
        video: "https://macdn.hakunaymatata.com/resource/af3218ce4edda6bbd5e5e39b4b92df70.mp4?Expires=1749410153&Signature=3n1kiHVjTPUM0NHCue5faW34i5k-IVZcdcCoKlKGK~epwc9yWLM2J3Ow3u14iOKi7jFv4I34I5M0qa10KOWpuVemwGFBgeePVl27kJ3rZjvClaVVV1zXDjI74bMHuHMtxooJewRJUWEE8cL57NbxmZSIYP9jI~AJNAZyBHjEAGF4VcuhY-FIgdDj6Swg8bz2N-i78ALPRW4~LxMa1whKIn2j~bN82fku48UETgEu27yI41Kgq~apLhc404N42PSeniK3~Hdr3eYx6uam-JvBxLXS2aldCFyIj4zMwkb1h9PlHnVuvDvTAhWMXQxG81kqKj4RsJO67~V4htxpNiuB2w__&Key-Pair-Id=KMHN1LQ1HEUPL",
        image: "https://image.tmdb.org/t/p/w300/6pFcTY18M9EpKQEEZZMzVnX4bMF.jpg",
        description: "Groot discovers a miniature civilization that believes the seemingly enormous tree toddler is the hero they've been waiting for.",
        duration: "4 min",
        season: 1,
        episode: 2,
        tags: ["Adventure", "Comedy"]
      },
      {
        title: "Groot's Pursuit",
        video: "https://vgorigin.hakunaymatata.com/resource/7de8ac3b05e4aa1dd0dfd9a80d68ca35.mp4?Expires=1749410349&KeyName=wefeed&Signature=VgLXJSuL_iVoKtabnEpFvmOPTgwIC1glS1RNPhslMfzkBKV1NYtV3jV9wxT9O4IpAwveRNmz7eLugXHBK7qmCQ",
        image: "https://image.tmdb.org/t/p/w300/nv0q5V1vGwRVO4Rv3MOEmniUbWj.jpg",
        description: "Groot investigates a spooky noise that's been haunting the Quadrant, which leads to an intense dance off.",
        duration: "4 min",
        season: 1,
        episode: 3,
        tags: ["Comedy", "Sci-Fi"]
      },
      {
        title: "Groot Takes a Bath",
        video: "https://macdn.hakunaymatata.com/resource/83f86aa6066c984964574f5e173d8226.mp4?Expires=1749410557&Signature=I3kgFtadusb5mzwkw4SRJHEBS1KUka-v3qsIH34JBti2~do4wH5IT2bGFSZNv9IEZgAs12O8rhGpKV965lkwxrHfDfwinQtH5HqRw0b2htyhVkFXbhM~IQdwApWxYHpEKvnQcB5FkdE362XwFBhmhdpJmTJ2ucis5mrpkLxU4HMT7B4OUHRjAWL-jnFnpRrGMnz~r3z6N6IXGS9DKBo9s3PqdeaGWwb0gGFjUH3CSC295vpgs6DZLwEsLvMf23uBx~TSrae4y0mRq1fkNc3dKdGI61BKZqs8uugHBELYHJ6g8Mwaj8WM4n-ADUEsl-7qbOF-S4wsH0WUYDL7EzCkcw__&Key-Pair-Id=KMHN1LQ1HEUPL",
        image: "https://image.tmdb.org/t/p/w300/stKeLppDBwscxoE9RXxNyrur27G.jpg",
        description: "Everybody needs some alone time to relax and wash up, but things go quite differently when you're a Flora Colossi toddler.",
        duration: "4 min",
        season: 1,
        episode: 4,
        tags: ["Comedy", "Family"]
      },
      {
        title: "Magnum Opus",
        video: "https://cdn4521.lop3sdi5dq5.com/stream2/i-arch-400/a5b5ae66248be0039515bda55fa1d488/MJTMsp1RshGTygnMNRUR2N2MSlnWXZEdMNDZzQWe5MDZzMmdZJTO1R2RWVHZDljekhkSsl1VwYnWtx2cihVT2llaCtmWHFFeOpWWy8EVZBTWqtmMZJTR61keZp3TX5kaa1WTx8EVFVjWHlUP:1748570540:89.116.30.152:9fb5f1165ca690d25ae9355ddf668ec784a71f9fad07d9bd11e3c6ced9880fa6/720/index.m3u8",
        image: "https://image.tmdb.org/t/p/w300/cnhzecqkKHBIyM4QMbxRy5fbW3l.jpg",
        description: "Groot sets out to paint a family portrait of himself and the Guardians, only to discover just how messy the artistic process can be.",
        duration: "4 min",
        season: 1,
        episode: 5,
        tags: ["Comedy", "Family"]
      },

      // Season 2
      {
        title: "Are You My Groot?",
        video: "https://macdn.hakunaymatata.com/resource/de4e89d34d8993b2d3708d0eda071ba3.mp4?Expires=1749409894&Signature=w1DQLOMttvVMtOoNlsCfIpBzGQIwKoLdDxaqh-fPtF8qZtoTkxcSTFGOU6EulgPirjuwcRHsQJPUyVa8CV33ugq-CiT5K7pIO-pOurxpT~nxz1sIEBH7Tp4DCd3c3pUt9pEv5hRIn0l8xXs58c9V~M-gSuWzp1bc7nzictcP4x0ve7NGBFcOW7q6nsyUyeAqHdKJkmrIb-XdFhgK6e9TM~fE8jMZWRUgun0dFOV8pe-cxkQkh8m3aoTbCJFO6C7nTzxrc2TtMT1Z6-ZI1X6VIr6kjpJE0mkR0cDA-0jx~6o1ZsQeVAm~yIlEemBVlhkV8PPeYjYhSaQyA0Rqk4jZfQ__&Key-Pair-Id=KMHN1LQ1HEUPL",
        image: "https://image.tmdb.org/t/p/w300/rJelmgL1yTFfH2PhC3LufMhYQko.jpg",
        description: "Groot stumbles across a strange egg, adopting the little creature that emerges as his own.",
        duration: "5 min",
        season: 2,
        episode: 1,
        tags: ["Adventure", "Comedy"]
      },
      {
        title: "Groot Noses Around",
        video: "https://macdn.hakunaymatata.com/resource/8a1a2ae9a183a2fa0e90f9f59dafae93.mp4?Expires=1749410489&Signature=CHbmbnLWLoCIor5qA57J4nux5bACNb~7Lj1KOJxM3g2eRfjPf3GiXfvRINWf2CaKQrimGceCJQs8adw8P~HNei-P-ThkIRdsSkFXKVB5pWCGoTZ4Mjvb8660nQRCZ9yrEMgJXKEkbUrSnSfiP9WvJ675g6Dk7m6zLw6e2435qKQVH2U~lXGCZXMNKRBnWNnRFMyLgikgO30mgw2gSDgfs-amOcA9HSViukitvDOdcTexVby52FuzBWfjttj0Pu1rzdQepCvXLwb9cVfr6zAx-K6fp9zgy2yTMdgiFq3y19wnjsT9D6-yA6ejqtyzH-YnPWnXgrRC4oZ6h5lM8Fv8bA__&Key-Pair-Id=KMHN1LQ1HEUPL",
        image: "https://image.tmdb.org/t/p/w300/bf39ykfbUodisUirJXcUbI8bRFe.jpg",
        description: "When Groot gets the sense of smell, he learns not to stick his new nose where it doesn't belong.",
        duration: "5 min",
        season: 2,
        episode: 2,
        tags: ["Adventure", "Family"]
      },
      {
        title: "Groot's Snow Day",
        video: "https://macdn.hakunaymatata.com/resource/1ad9b7f4793896affedb670125df0858.mp4?Expires=1749413775&Signature=Uk82AD9vnaTs6dm66TJWnBMxm6yMvgBJVYdCAl2VMO1RuOJPqgWIVvPpLY79dx~F3ZaQpRbQV56RfXEKIZwGfzSBU3vrMToDUb-oFKwY3oMwEJBpfhaWTJivbH6E1VHXnIiyOqazPY7wY3CYiwSec636HUWoT2mYwAJ8zis4v9H0Lk7dkSUHPFBgaNNCvediCi0CuNp0ql~TWiIv4KVSWtNpaJQs-Uy35AJ8GRQbmqGVohho3WoSgCUCUle35Yhul40DuldxSrAROaru1a1NkcOywFHDdoRLrGBsXi1ULmqueGftBkq1pQ2DsLoF55PLMx-o2b2JNNZbpMxwbw-pRw__&Key-Pair-Id=KMHN1LQ1HEUPL",
        image: "https://image.tmdb.org/t/p/w300/6H9lUVRUJyWn7t0VAix83TszrfJ.jpg",
        description: "Groot builds a snowman with scraps of junk, creating an unstoppable snowman-robot that wreaks havoc.",
        duration: "4 min",
        season: 2,
        episode: 3,
        tags: ["Comedy", "Family"]
      },
      {
        title: "Groot's Sweet Treat",
        video: "https://macdn.hakunaymatata.com/resource/2d26d733932b288d9f88b7dd153feefe.mp4?Expires=1749413823&Signature=J2zUOlESkbW2SKHxnQVQqufYG17lBBjxtHK5SsJt2yVp~C2QRNDmULHpznP-6iXdnvYwiRmM1dLhmRnz2kJrz8HtejdQz3O6CtC-CFYF1n7aJ5A-oYS~D~en3fNNS7-YeUhVp5j4gh2fvG-YEVeMuhixTFHa4IVXaN0SMw2OUryDDGVpy6RRzPW5hydxJ3X~0uUt87Hc7wA4MS0jayezsK5cL30JoBaf0hnPRn5AJuFzCUasHtH3QrJd0wvX9rYsQktXZcQIhiucWJ3wjc0ShbWJxehvLfYNTUPyooS~goWCkiK16LF5D1ZcF~ol37ogKri-z44uInNnnSPApLUAbA__&Key-Pair-Id=KMHN1LQ1HEUPL",
        image: "https://image.tmdb.org/t/p/w300/4PSxBL0Muya07GIteMxJhA4A2iB.jpg",
        description: "Groot frantically scours the ship for coins as an intergalactic ice cream truck approaches.",
        duration: "6 min",
        season: 2,
        episode: 4,
        tags: ["Adventure", "Family"]
      },
      {
        title: "Groot and the Great Prophecy",
        video: "https://macdn.hakunaymatata.com/resource/e71df8f64ac613e8947743d8a40a3f82.mp4?Expires=1749412171&Signature=mMR6JeivZPPuB-0QgfTbXFG64zSMFuX-B2l9v61ahUyCkcAjsW8aV60wAQ2eANUXrbTKAPwopeRr-f0Bp0eNRMAvciorqEnvK9dmigGM8qgAyzHY5nbYzWk6iOSeKJjJ~ki-ai9ojMHNXNASU1c3jDVeLj8GG2V77q9GWiM0YD02bFa9Hxee~JUyNmAB46Rh-BO1sdNsxo1lQ6b737Cpf8yH9JtvIBkQOlzAHNd2VUnbbJGNaJs0XqGhLBoB5QjY8NEPWjtzZ1ThFWlgVBGxfa3HCbJnABiSqQb3ShTX6WFn68xqusSUF55ER0YEyx6ebARjzfuEpuFC09AmcaSJWQ__&Key-Pair-Id=KMHN1LQ1HEUPL",
        image: "https://image.tmdb.org/t/p/w300/o7gblk3nygQh2lEIjCHEdLK3RHA.jpg",
        description: "Groot lands in the heart of an ancient temple with a prophecy he must fulfill to save the universe.",
        duration: "5 min",
        season: 2,
        episode: 5,
        tags: ["Comedy", "Sci-Fi"]
      }
    ];

    /* -------------------------
       DOM references and init
       ------------------------- */
    const searchBar = document.getElementById('searchBar');
    const themeToggle = document.getElementById('theme-toggle');
    const loadingSpinner = document.getElementById('loading-spinner');
    const episodeCount = document.getElementById('episode-count');
    const searchCounter = document.getElementById('searchCounter');
    const backToTop = document.getElementById('backToTop');

    document.addEventListener('DOMContentLoaded', () => {
      renderMovies(movies);
      setupEventListeners();
      checkThemePreference();
      // ensure both season contents are expanded initially
      document.querySelectorAll('.season-content').forEach(c => c.classList.remove('hidden'));
    });

    /* -------------------------
       Render function (fixed)
       - previous issues fixed:
         - now appends to the correct season container
         - uses movie.tags (not movie.genre)
         - checks for rating safely
         - updates episode count correctly
       ------------------------- */
    function renderMovies(moviesToRender) {
      // Clear all season containers first
      document.querySelectorAll('.season-content').forEach(container => {
        container.innerHTML = '';
      });

      // Update episode count (total items shown)
      episodeCount.textContent = `(${moviesToRender.length})`;

      moviesToRender.forEach((movie, index) => {
        const seasonContainer = document.querySelector(`.season-content[data-season="${movie.season}"]`);
        if (!seasonContainer) return; // safety

        const delayClass = `animate-fade-in`;
        const movieCard = document.createElement('div');
        movieCard.className = `movie-card ${delayClass}`;

        // Safely map tags -> UI labels
        const tagsHtml = (movie.tags || []).map(t => `<span class="tag">${t}</span>`).join('');

        // Only show duration if present
        const durationHtml = movie.duration ? `<span class="text-xs px-2 py-1 rounded bg-black/50 text-gray-200">${movie.duration}</span>` : '';

        movieCard.innerHTML = `
          <div class="relative overflow-hidden rounded-xl movie-poster">
            <img src="${movie.image}" alt="${(movie.title || 'Episode')}" loading="lazy" />
            <div class="movie-meta">
              <div class="flex justify-between items-center mb-2">
                <div class="flex items-center">${tagsHtml}</div>
                <div>${durationHtml}</div>
              </div>
              <h3 class="text-sm md:text-base font-semibold text-white truncate">${movie.title}</h3>
              <p class="text-xs text-gray-300 mt-1 line-clamp-2">${movie.description}</p>
            </div>
            <div class="play-overlay">
              <button class="play-button" title="Play">
                <i class="fas fa-play"></i>
              </button>
            </div>
          </div>
        `;

        // Keep original behavior: clicking card triggers loading spinner then navigates to player.html with query params
        movieCard.addEventListener('click', (e) => {
          // Ensure the click triggers navigation even if clicked on inner play icon
          loadingSpinner.classList.remove('hidden');
          setTimeout(() => {
            const url = `player.html?title=${encodeURIComponent(movie.title)}&video=${encodeURIComponent(movie.video)}&index=${index}`;
            window.location.href = url;
          }, 500);
        });

        seasonContainer.appendChild(movieCard);
      });
    }

    /* -------------------------
       Event listeners
       ------------------------- */
    function setupEventListeners() {
      // Season accordion toggles (preserve original toggling behavior)
      document.querySelectorAll('.season-toggle').forEach(toggle => {
        toggle.addEventListener('click', function() {
          const content = this.nextElementSibling;
          const icon = this.querySelector('i');
          content.classList.toggle('hidden');
          icon.classList.toggle('rotate-180');
        });
      });

      // Search functionality (fixed to use tags)
      searchBar.addEventListener('input', function() {
        const searchTerm = this.value.trim().toLowerCase();
        if (searchTerm === '') {
          searchCounter.style.display = 'none';
          renderMovies(movies);
          return;
        }

        const filteredMovies = movies.filter(movie =>
          (movie.title && movie.title.toLowerCase().includes(searchTerm)) ||
          (movie.description && movie.description.toLowerCase().includes(searchTerm)) ||
          (movie.tags && movie.tags.some(t => t.toLowerCase().includes(searchTerm)))
        );

        // show matching count in counter
        searchCounter.textContent = filteredMovies.length;
        searchCounter.style.display = 'inline-flex';

        renderMovies(filteredMovies);
      });

      // Filter chips (fixed to use movie.tags)
      document.querySelectorAll('.filter-chip').forEach(chip => {
        chip.addEventListener('click', function() {
          // keep one active
          document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
          this.classList.add('active');

          const filterText = this.dataset.filter || this.textContent.trim();
          if (filterText === 'All Episodes') {
            renderMovies(movies);
          } else {
            const filteredMovies = movies.filter(movie =>
              movie.tags && movie.tags.includes(filterText)
            );
            renderMovies(filteredMovies);
          }

          // clear search input and counter when using chips
          searchBar.value = '';
          searchCounter.style.display = 'none';
        });
      });

      // Theme toggle (keeps original storage)
      themeToggle.addEventListener('click', toggleTheme);

      // Back to top button visibility & click
      window.addEventListener('scroll', () => {
        if (window.pageYOffset > 300) {
          backToTop.classList.add('visible');
        } else {
          backToTop.classList.remove('visible');
        }

        // preserve original "infinite scroll placeholder" logic (no-op)
        if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 500) {
          // placeholder: in a real app you'd fetch more data here
        }
      });
      backToTop.addEventListener('click', () => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });

      // Sort select (lightweight local sort, preserves players/links)
      const sortSelect = document.getElementById('sortSelect');
      sortSelect.addEventListener('change', () => {
        const value = sortSelect.value;
        let sorted = [...movies];
        if (value === 'alpha') {
          sorted.sort((a,b) => a.title.localeCompare(b.title));
        } else if (value === 'release') {
          // no release dates available; keep original order
        } else if (value === 'pop') {
          // no popularity metric available; keep original
        }
        renderMovies(sorted);
      });
    }

    /* -------------------------
       Theme helpers (unchanged logic)
       ------------------------- */
    function checkThemePreference() {
      if (localStorage.getItem('theme') === 'dark' ||
        (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
        themeToggle.innerHTML = '<i class="fas fa-sun text-yellow-400"></i>';
      } else {
        document.documentElement.classList.remove('dark');
        themeToggle.innerHTML = '<i class="fas fa-moon text-yellow-400"></i>';
      }
    }

    function toggleTheme() {
      if (document.documentElement.classList.contains('dark')) {
        document.documentElement.classList.remove('dark');
        localStorage.setItem('theme', 'light');
        themeToggle.innerHTML = '<i class="fas fa-moon text-yellow-400"></i>';
      } else {
        document.documentElement.classList.add('dark');
        localStorage.setItem('theme', 'dark');
        themeToggle.innerHTML = '<i class="fas fa-sun text-yellow-400"></i>';
      }
    }
  </script>
</body>
</html>
